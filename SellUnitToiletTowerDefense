_G.SettingRaritySell = {
    ["Basic"] = true,
    ["Uncommon"] = true,
    ["Rare"] = true,
    ["Epic"] = true,
    ["Legendary"] = false,
    ["Mythic"] = false,
    ['Godly'] = false,
    ["Exclusive"] = false,
    ["Ultimate"] = false,

}
repeat
    wait()
until game:IsLoaded()
repeat
    wait()
until game.Players.LocalPlayer
local plr = game.Players.LocalPlayer

repeat
    wait()
until plr.Character
repeat
    wait()
until plr.Character:FindFirstChild("HumanoidRootPart")
repeat
    wait()
until plr.Character:FindFirstChild("Humanoid")
spawn(
    function()
        while wait() do
            game:GetService("Players").LocalPlayer.PlayerGui.Lobby.RejoinMatch.Visible = false
            game:GetService("Players").LocalPlayer.PlayerGui.MainFrames.NotificationFrame.Visible = false
        end
    end
)

local StarterGui = game:GetService("StarterGui")
StarterGui:SetCoreGuiEnabled(Enum.CoreGuiType.PlayerList, false)
function ClickButton(x, y)
    game:GetService("VirtualInputManager"):SendMouseButtonEvent(x, y, 0, true, game, 1)
    game:GetService("VirtualInputManager"):SendMouseButtonEvent(x, y, 0, false, game, 1)
end
RarityColor = {}
function ConvertGradientToRGB(v,num)
    color = v.Color.Keypoints[num].Value
    local r = math.floor(color.R * 255)
    local g = math.floor(color.G * 255)
    local b = math.floor(color.B * 255)
    return Color3.fromRGB(r,g,b)
end
for _, v in pairs(game:GetService("Players").LocalPlayer.PlayerGui.Lobby.MarketplaceFrame.MarketplaceMain.MainFrame.BuyMenu.FilterBar.Rarities:GetChildren()) do 
if v:IsA("Frame") then
    RarityColor[v.Name] = {
        ["1"] = ConvertGradientToRGB(v.FilterButton[v.Name], 1),
        ["2"] = ConvertGradientToRGB(v.FilterButton[v.Name], 2)
    }
end
end
function GetRarity(color1, color2)
    for rarity, colors in pairs(RarityColor) do
        if (color1 == colors["1"] and color2 == colors["2"]) then
            return rarity 
        end
    end
end

ListRaritySell = {}
for i,v in pairs(_G.SettingRaritySell) do 
    if v == true then 
        table.insert(ListRaritySell,i)
    end
end

function CheckRarity(v)
    if table.find(ListRaritySell ,GetRarity(ConvertGradientToRGB(v,1),ConvertGradientToRGB(v,2))) then 
        return true 
    end 
    return false 
end 
function GetUnitList()
    game:GetService("Players").LocalPlayer.PlayerGui.Lobby.UnitFrame.UnitList.Visible= true 
    wait(.1)
    unitlist = {}
    for i,v in pairs(game:GetService("Players").LocalPlayer.PlayerGui.Lobby.UnitFrame.UnitList:GetChildren()) do 

        if v:IsA("Frame") then 
            table.insert(unitlist,v.Name)
        end 
    end 
    game:GetService("Players").LocalPlayer.PlayerGui.Lobby.UnitFrame.UnitList.Visible= false
end
table.sort(unitlist)

while _G.Toggle do wait()
    if game:GetService("Players").LocalPlayer.PlayerGui.Lobby.UnitFrame.UnitList.Visible then 
        if game:GetService("Players").LocalPlayer.PlayerGui.Lobby.UnitFrame.UnitList.UIGridLayout.SortOrder ~= "Name" then 
            game:GetService("Players").LocalPlayer.PlayerGui.Lobby.UnitFrame.UnitList.UIGridLayout.SortOrder = "Name"
        else 
            if game:GetService("Players").LocalPlayer.PlayerGui.Lobby.UnitFrame.Buttons.SellUnits.Button.Text == "Sell Units" then 
                repeat wait()
                    ClickButton(616,420)
                    wait(.1)
                until  game:GetService("Players").LocalPlayer.PlayerGui.Lobby.UnitFrame.Buttons.SellUnits.Button.Text == "Cancel"
            else 
                for i,v in pairs(unitlist) do
                    
                    if CheckRarity(game:GetService("Players").LocalPlayer.PlayerGui.Lobby.UnitFrame.UnitList[v].TroopsFrame.Background.RarityGradient) then 
                        if game:GetService("Players").LocalPlayer.PlayerGui.Lobby.UnitFrame.UnitList[v].TroopsFrame.BulkSellIcon.Visible then 
                            ClickButton(616,420)
                        else 
                            ClickButton(290,190)
                            wait(.1)
                        end
                    else 
                        CheckRarity(game:GetService("Players").LocalPlayer.PlayerGui.Lobby.UnitFrame.UnitList[v].Visible = false 
                    end 
                end     
            end
        end
    else 
        game:GetService("Players").LocalPlayer.PlayerGui.Lobby.UnitFrame.UnitList.Visible= true 
    end 
end 

