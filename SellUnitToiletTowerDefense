repeat
    wait()
until game:IsLoaded()
repeat
    wait()
until game.Players.LocalPlayer
local plr = game.Players.LocalPlayer

repeat
    wait()
until plr.Character
repeat
    wait()
until plr.Character:FindFirstChild("HumanoidRootPart")
repeat
    wait()
until plr.Character:FindFirstChild("Humanoid")

local StarterGui = game:GetService("StarterGui")
StarterGui:SetCoreGuiEnabled(Enum.CoreGuiType.PlayerList, false)
function ClickButton(x, y)
    game:GetService("VirtualInputManager"):SendMouseButtonEvent(x, y, 0, true, game, 1)
    game:GetService("VirtualInputManager"):SendMouseButtonEvent(x, y, 0, false, game, 1)
end
spawn(
    function()
        while wait() do
            if game:GetService("Players").LocalPlayer.PlayerGui.MainFrames.NotificationFrame.Visible then
                if  string.find(game:GetService("Players").LocalPlayer.PlayerGui.MainFrames.NotificationFrame.BigNotification.HeyText.Text,"trade") then 
                    ClickButton(550,330)
                elseif string.find(game:GetService("Players").LocalPlayer.PlayerGui.MainFrames.NotificationFrame.BigNotification.HeyText.Text,"recieved") or string.find(game:GetService("Players").LocalPlayer.PlayerGui.MainFrames.NotificationFrame.BigNotification.HeyText.Text,"not ready") or string.find(game:GetService("Players").LocalPlayer.PlayerGui.MainFrames.NotificationFrame.BigNotification.HeyText.Text,"VIP")then
                     ClickButton(480,330)
                end
            end
            
            game:GetService("Players").LocalPlayer.PlayerGui.Lobby.RejoinMatch.Visible = false
        end
    end
)

RarityColor = {}
function ConvertGradientToRGB(v,num)
    color = v.Color.Keypoints[num].Value
    local r = math.floor(color.R * 255)
    local g = math.floor(color.G * 255)
    local b = math.floor(color.B * 255)
    return Color3.fromRGB(r,g,b)
end
for _, v in pairs(game:GetService("Players").LocalPlayer.PlayerGui.Lobby.MarketplaceFrame.MarketplaceMain.MainFrame.BuyMenu.FilterBar.Rarities:GetChildren()) do 
if v:IsA("Frame") then
    RarityColor[v.Name] = {
        ["1"] = ConvertGradientToRGB(v.FilterButton[v.Name], 1),
        ["2"] = ConvertGradientToRGB(v.FilterButton[v.Name], 2)
    }
end
end
function GetRarity(color1, color2)
    for rarity, colors in pairs(RarityColor) do
        if (color1 == colors["1"] and color2 == colors["2"]) then
            return rarity 
        end
    end
end

ListRaritySell = {}
for i,v in pairs(_G.SettingRaritySell) do 
    if v == true then 
        table.insert(ListRaritySell,i)
    end
end

function CheckRarity(v)
    if table.find(ListRaritySell ,GetRarity(ConvertGradientToRGB(v,1),ConvertGradientToRGB(v,2))) then 
        return true 
    end 
    return false 
end 
function GetUnitList()
    ClickButton(100,55)
    if #game:GetService("Players").LocalPlayer.PlayerGui.Lobby.UnitFrame.UnitList:GetChildren() <= 1 then 
        repeat wait()
            ClickButton(26,170)
            wait(.5)
        until #game:GetService("Players").LocalPlayer.PlayerGui.Lobby.UnitFrame.UnitList:GetChildren() > 1
    end
    unitlist = {}
    for i,v in pairs(game:GetService("Players").LocalPlayer.PlayerGui.Lobby.UnitFrame.UnitList:GetChildren()) do 

        if v:IsA("Frame") then 
            table.insert(unitlist,v.Name)
        end 
    end 
    game:GetService("Players").LocalPlayer.PlayerGui.Lobby.UnitFrame.Visible= false
    table.sort(unitlist)
end
GetUnitList()

while _G.Toggle do wait()
    if  game:GetService("Players").LocalPlayer.PlayerGui.Lobby.UnitFrame.Visible then 
        game:GetService("Players").LocalPlayer.PlayerGui.Lobby.UnitFrame.UnitList.UIGridLayout.SortOrder = "Name"
        wait(.1)
        if game:GetService("Players").LocalPlayer.PlayerGui.Lobby.UnitFrame.Buttons.SellUnits.Button.Text == "Sell Units" then 
            print('bật chế độ bán')
            repeat wait()
                ClickButton(616,420)
                wait(.1)
            until  game:GetService("Players").LocalPlayer.PlayerGui.Lobby.UnitFrame.Buttons.SellUnits.Button.Text == "Cancel"
        else 
            for i,v in pairs(unitlist) do
                if not game:GetService("Players").LocalPlayer.PlayerGui.Lobby.UnitFrame.UnitList[v].TroopsFrame.TroopIcon.Image == 'rbxassetid://15798757056' then    
                    if CheckRarity(game:GetService("Players").LocalPlayer.PlayerGui.Lobby.UnitFrame.UnitList[v].TroopsFrame.Background.RarityGradient)  then 
                        print('chọn unit để bán')
                        
                        if not  game:GetService("Players").LocalPlayer.PlayerGui.Lobby.UnitFrame.UnitList[v].TroopsFrame.BulkSellIcon.Visible then 
                            repeat wait()
                                ClickButton(290,190)
                                wait(.5)
                            until game:GetService("Players").LocalPlayer.PlayerGui.Lobby.UnitFrame.UnitList[v].TroopsFrame.BulkSellIcon.Visible
                        end 
                        if not game:GetService("Players").LocalPlayer.PlayerGui.MainFrames.NotificationFrame.Visible then 
                            repeat wait()
                                ClickButton(616,420)
                                wait(.5)
                            until game:GetService("Players").LocalPlayer.PlayerGui.MainFrames.NotificationFrame.Visible 
                            ClickButton(400,330)
                            wait(.5)
                        end
                        
                        
                    else 
                        print('ẩn unit')
                        game:GetService("Players").LocalPlayer.PlayerGui.Lobby.UnitFrame.UnitList[v].Visible = false 
                        wait(.3)
                    end
                else 
                    print('ẩn unit')
                    game:GetService("Players").LocalPlayer.PlayerGui.Lobby.UnitFrame.UnitList[v].Visible = false 
                    wait(.3)
                end
            end     
        end
    else 
        print('mở gui unit')
        game:GetService("Players").LocalPlayer.PlayerGui.Lobby.UnitFrame.Visible= true 
    end 
end 

